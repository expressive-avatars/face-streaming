var O=Object.defineProperty;var L=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var y=(t,e,o)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,w=(t,e)=>{for(var o in e||(e={}))D.call(e,o)&&y(t,o,e[o]);if(L)for(var o of L(e))F.call(e,o)&&y(t,o,e[o]);return t};import{j as r,u as R,c as U,r as c,a as C,l as S,M as h,b as u,Q as E,t as m,F as j,A as I,d as q,C as P,O as M,E as N,e as A,R as T,f as B,H as W,S as H,g as d,L as k}from"./vendor.5634fd8c.js";const V=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}};V();function z(t){return r("div",w({style:{position:"absolute",inset:0}},t))}function G({children:t}){const{camera:e}=R();return U(t,e)}function J(t){const{xr:e}=t,[o,s]=c.exports.useState(()=>e.getSession());return c.exports.useEffect(()=>{const n=()=>s(e.getSession());return e.addEventListener("sessionstart",n),e.addEventListener("sessionend",n),()=>{e.removeEventListener("sessionstart",n),e.removeEventListener("sessionend",n)}},[e]),o}function p(t){const{gl:e}=R(),o=J(e);c.exports.useEffect(()=>{o&&o.updateWorldSensingState({meshDetectionState:{enabled:!0}})},[o]),C((s,n)=>{const i=n.worldInformation;i.meshes&&i.meshes.forEach(a=>{a.changed&&t(X(a.blendShapes),a.modelMatrix)})})}const Q={browDownLeft:"browDownRight",browDownRight:"browDownLeft",browInnerUp:"browInnerUp",browOuterUpLeft:"browOuterUpRight",browOuterUpRight:"browOuterUpLeft",cheekPuff:"cheekPuff",cheekSquintLeft:"cheekSquintRight",cheekSquintRight:"cheekSquintLeft",eyeBlinkLeft:"eyeBlinkRight",eyeBlinkRight:"eyeBlinkLeft",eyeLookDownLeft:"eyeLookDownRight",eyeLookDownRight:"eyeLookDownLeft",eyeLookInLeft:"eyeLookInRight",eyeLookInRight:"eyeLookInLeft",eyeLookOutLeft:"eyeLookOutRight",eyeLookOutRight:"eyeLookOutLeft",eyeLookUpLeft:"eyeLookUpRight",eyeLookUpRight:"eyeLookUpLeft",eyeSquintLeft:"eyeSquintRight",eyeSquintRight:"eyeSquintLeft",eyeWideLeft:"eyeWideRight",eyeWideRight:"eyeWideLeft",jawForward:"jawForward",jawLeft:"jawRight",jawOpen:"jawOpen",jawRight:"jawLeft",mouthClose:"mouthClose",mouthDimpleLeft:"mouthDimpleRight",mouthDimpleRight:"mouthDimpleLeft",mouthFrownLeft:"mouthFrownRight",mouthFrownRight:"mouthFrownLeft",mouthFunnel:"mouthFunnel",mouthLeft:"mouthRight",mouthLowerDownLeft:"mouthLowerDownRight",mouthLowerDownRight:"mouthLowerDownLeft",mouthPressLeft:"mouthPressRight",mouthPressRight:"mouthPressLeft",mouthPucker:"mouthPucker",mouthRight:"mouthLeft",mouthRollLower:"mouthRollLower",mouthRollUpper:"mouthRollUpper",mouthShrugLower:"mouthShrugLower",mouthShrugUpper:"mouthShrugUpper",mouthSmileLeft:"mouthSmileRight",mouthSmileRight:"mouthSmileLeft",mouthStretchLeft:"mouthStretchRight",mouthStretchRight:"mouthStretchLeft",mouthUpperUpLeft:"mouthUpperUpRight",mouthUpperUpRight:"mouthUpperUpLeft",noseSneerLeft:"noseSneerRight",noseSneerRight:"noseSneerLeft"};function X(t){return Object.fromEntries(Object.keys(t).map(e=>[e,t[Q[e]]]))}function _(t,e){return c.exports.useMemo(()=>S(t,e),[t])}const b=new h;function $({email:t}){const e=_("https://expressive-avatars-server.herokuapp.com/provider",{query:{email:t}});return p((o,s)=>{b.fromArray(s).multiply(l.matrixOffset),e.volatile.emit("face",{blendShapes:o,matrix:b.toArray()})}),null}new E;const v=new h;function K(){const t=c.exports.useRef();return p((e,o)=>{v.fromArray(o).multiply(l.matrixOffset),t.current.quaternion.setFromRotationMatrix(v)}),r("group",{"position-z":-4,children:u("mesh",{ref:t,children:[r("boxGeometry",{}),r("meshNormalMaterial",{})]})})}function Y(t,e){const[o,s]=c.exports.useState(()=>{try{const i=window.localStorage.getItem(t);return i?JSON.parse(i):e}catch(i){return console.log(i),e}});return[o,i=>{try{const a=i instanceof Function?i(o):i;s(a),window.localStorage.setItem(t,JSON.stringify(a))}catch(a){console.log(a)}}]}function Z({onChange:t=()=>{}}){const[e,o]=Y("email");return u("div",{className:m`bg-gray-200 border rounded-lg p-4 flex gap-2`,children:[r("input",{className:m`px-2 py-1`,onChange:s=>o(s.target.value),value:e,placeholder:"Enter your email"}),r("button",{className:m`bg-blue-500 px-2 py-1 text-white font-semibold rounded`,onClick:()=>t(e),children:"Start"})]})}const l={needsCalibration:!1,matrixOffset:new h};function ee(){const{rootEl:t,DomOverlay:e}=oe(),[o,s]=c.exports.useState();return r(z,{children:o?u(j,{children:[u(I,{sessionInit:{requiredFeatures:["worldSensing","dom-overlay"],domOverlay:{root:t}},camera:{fov:35},children:[r($,{email:o}),r(te,{}),u(G,{children:[r(K,{}),r("directionalLight",{position:3}),r("ambientLight",{intensity:.5})]})]}),r(e,{children:r("div",{style:{position:"absolute",inset:0},children:r("button",{className:m`bg-blue-500 px-2 py-1 rounded text-white font-semibold m-4`,onClick:()=>l.needsCalibration=!0,children:"Calibrate"})})})]}):r(Z,{onChange:n=>s(n)})})}function te(){return p((t,e)=>{l.needsCalibration&&(l.matrixOffset.fromArray(e).invert(),l.needsCalibration=!1)}),null}function oe(){const[t]=c.exports.useState(()=>{const o=document.createElement("div");return document.body.appendChild(o),o});function e({children:o}){return q.exports.createPortal(o,t)}return{rootEl:t,DomOverlay:e}}function re(){return u(P,{camera:{fov:35,position:[0,0,3]},children:[r("color",{attach:"background",args:["black"]}),u(c.exports.Suspense,{fallback:null,children:[r(M,{}),r(ie,{}),r(N,{preset:"warehouse",background:!0})]})]})}const ne="https://d1a370nemizbjq.cloudfront.net/54a8ca1e-1759-4cf9-ab76-bec155d6c83c.glb",x=new h;function ie(){const{scene:t,nodes:e}=A(ne),o=e.Wolf3D_Head,s=e.Wolf3D_Teeth,n=e.Head;return se((i,a)=>{x.fromArray(a),n.quaternion.setFromRotationMatrix(x);for(let f in i){const g=o.morphTargetDictionary[f];o.morphTargetInfluences[g]=i[f],s.morphTargetInfluences[g]=i[f]}}),r("primitive",{object:t,position:[0,-2.4,0],scale:4})}function se(t){c.exports.useEffect(()=>{const e=S("https://expressive-avatars-server.herokuapp.com"),o=()=>{console.log("connected to socket.io server")},s=({blendShapes:n,matrix:i})=>t(n,i);return e.on("connect",o),e.on("face",s),()=>{e.off("connect",o),e.off("face",s)}},[])}T.render(r(B.StrictMode,{children:r(W,{children:u(H,{children:[r(d,{path:"/",exact:!0,children:u("ul",{children:[r(k,{to:"/sender",children:r("li",{children:"Sender"})}),r(k,{to:"/receiver",children:r("li",{children:"Receiver"})})]})}),r(d,{path:"/receiver",children:r(re,{})}),r(d,{path:"/sender",children:r(ee,{})})]})})}),document.getElementById("root"));
