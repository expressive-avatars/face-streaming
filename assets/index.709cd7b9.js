var X=Object.defineProperty,W=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var O=(t,e,n)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,w=(t,e)=>{for(var n in e||(e={}))x.call(e,n)&&O(t,n,e[n]);if(y)for(var n of y(e))k.call(e,n)&&O(t,n,e[n]);return t},R=(t,e)=>W(t,H(e));var L=(t,e)=>{var n={};for(var s in t)x.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&y)for(var s of y(t))e.indexOf(s)<0&&k.call(t,s)&&(n[s]=t[s]);return n};import{j as i,r as c,u as I,M as f,R as E,Q as b,a as V,C as z,X as Q,c as $,V as U,b as C,l as J,d as h,F as A,E as G,e as K,f as Y}from"./vendor.fc569ce0.js";const Z=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}};Z();function S(n){var s=n,{primary:t=!1}=s,e=L(s,["primary"]);return i("button",w({className:`${t?"border-0 text-white bg-hubs-blue hover:bh-hubs-lightblue":"border-2 border-hubs-blue text-hubs-blue hover:text-hubs-lightblue"} font-semibold px-5 py-2 rounded-lg`},e))}function v(){const[t]=c.exports.useState(()=>{try{const e=ee("credentials");return JSON.parse(e)}catch{return null}});return t}function ee(t){let e=t+"=",s=decodeURIComponent(document.cookie).split(";");for(let r=0;r<s.length;r++){let o=s[r];for(;o.charAt(0)==" ";)o=o.substring(1);if(o.indexOf(e)==0)return o.substring(e.length,o.length)}return""}function D(t=()=>{}){const{gl:e}=I(),{xr:n}=e,[s,r]=c.exports.useState(()=>n.getSession());return c.exports.useEffect(()=>{const o=()=>{const a=n.getSession();t(a),r(a)};return n.addEventListener("sessionstart",o),n.addEventListener("sessionend",o),()=>{n.removeEventListener("sessionstart",o),n.removeEventListener("sessionend",o)}},[n]),s}function F(t){const e=D(),[n,s]=c.exports.useState();return c.exports.useEffect(()=>{e&&e.requestReferenceSpace(t).then(r=>s(r))},[e]),n}const P=new f,M=new b,N=E.createContext();function te({children:t}){const e=c.exports.useRef(new Set),[[n,s]]=c.exports.useState(()=>[new b,new b]);D(u=>{u&&u.updateWorldSensingState({meshDetectionState:{enabled:!0}})});const r=F("local"),o=F("viewer");V((u,l)=>{const p=l.worldInformation;p.meshes&&r&&o&&p.meshes.forEach(d=>{if(d.changed&&d.blendShapes&&d.modelMatrix){const _=oe(d.blendShapes);P.fromArray(d.modelMatrix),n.setFromRotationMatrix(P);const g=l.getPose(o,r).transform.orientation;M.set(g.x,g.y,g.z,g.w),n.premultiply(M),e.current.forEach(B=>{B(_,n)})}})});const a={register:u=>(e.current.add(u),()=>e.current.delete(u))};return i(N.Provider,{children:t,value:a})}const ne={browDownLeft:"browDownRight",browDownRight:"browDownLeft",browInnerUp:"browInnerUp",browOuterUpLeft:"browOuterUpRight",browOuterUpRight:"browOuterUpLeft",cheekPuff:"cheekPuff",cheekSquintLeft:"cheekSquintRight",cheekSquintRight:"cheekSquintLeft",eyeBlinkLeft:"eyeBlinkRight",eyeBlinkRight:"eyeBlinkLeft",eyeLookDownLeft:"eyeLookDownRight",eyeLookDownRight:"eyeLookDownLeft",eyeLookInLeft:"eyeLookInRight",eyeLookInRight:"eyeLookInLeft",eyeLookOutLeft:"eyeLookOutRight",eyeLookOutRight:"eyeLookOutLeft",eyeLookUpLeft:"eyeLookUpRight",eyeLookUpRight:"eyeLookUpLeft",eyeSquintLeft:"eyeSquintRight",eyeSquintRight:"eyeSquintLeft",eyeWideLeft:"eyeWideRight",eyeWideRight:"eyeWideLeft",jawForward:"jawForward",jawLeft:"jawRight",jawOpen:"jawOpen",jawRight:"jawLeft",mouthClose:"mouthClose",mouthDimpleLeft:"mouthDimpleRight",mouthDimpleRight:"mouthDimpleLeft",mouthFrownLeft:"mouthFrownRight",mouthFrownRight:"mouthFrownLeft",mouthFunnel:"mouthFunnel",mouthLeft:"mouthRight",mouthLowerDownLeft:"mouthLowerDownRight",mouthLowerDownRight:"mouthLowerDownLeft",mouthPressLeft:"mouthPressRight",mouthPressRight:"mouthPressLeft",mouthPucker:"mouthPucker",mouthRight:"mouthLeft",mouthRollLower:"mouthRollLower",mouthRollUpper:"mouthRollUpper",mouthShrugLower:"mouthShrugLower",mouthShrugUpper:"mouthShrugUpper",mouthSmileLeft:"mouthSmileRight",mouthSmileRight:"mouthSmileLeft",mouthStretchLeft:"mouthStretchRight",mouthStretchRight:"mouthStretchLeft",mouthUpperUpLeft:"mouthUpperUpRight",mouthUpperUpRight:"mouthUpperUpLeft",noseSneerLeft:"noseSneerRight",noseSneerRight:"noseSneerLeft"};function oe(t){return Object.fromEntries(Object.keys(t).map(e=>{var n;return[e,(n=t[ne[e]])!=null?n:0]}))}class re{constructor(e,n={}){this.session=null,this.renderer=e,this.sessionInit=n,this._makeDefaultOverlay()}_makeDefaultOverlay(){if(this.sessionInit.domOverlay===void 0){const e=document.createElement("div");e.style.display="none",document.body.appendChild(e);const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("width",38),n.setAttribute("height",38),n.style.position="absolute",n.style.right="20px",n.style.top="20px",n.addEventListener("click",()=>{this.session.end()}),e.appendChild(n);const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),s.setAttribute("stroke","#fff"),s.setAttribute("stroke-width",2),n.appendChild(s),this.sessionInit.optionalFeatures===void 0&&(this.sessionInit.optionalFeatures=[]),this.sessionInit.optionalFeatures.push("dom-overlay"),this.sessionInit.domOverlay={root:e}}}start(){navigator.xr.requestSession("immersive-ar",this.sessionInit).then(this.onSessionStarted.bind(this))}end(){this.session.end()}get domOverlay(){return this.sessionInit.domOverlay}async onSessionStarted(e){this.session=e,e.addEventListener("end",this.onSessionEnded.bind(this)),this.renderer.xr.setReferenceSpaceType("local"),await this.renderer.xr.setSession(e),this.sessionInit.domOverlay.root.style.display=""}onSessionEnded(){this.session=null}}function se(r){var o=r,{onCreated:t,children:e,sessionInit:n}=o,s=L(o,["onCreated","children","sessionInit"]);return i(ie,R(w({onCreated:t},s),{children:e}))}function ie(s){var r=s,{foveation:t,children:e}=r,n=L(r,["foveation","children"]);return i(z,R(w({vr:!0},n),{children:i(Q,{foveation:t,children:e})}))}function ae({children:t}){const{camera:e}=I();return $(t,e)}function T(t){const{register:e}=c.exports.useContext(N);c.exports.useEffect(()=>e(t),[])}const m=new U,q=new U;class ce{constructor(e){if(!e.isMesh)throw new Error("CPUMorpher requires a THREE.Mesh instance");if(this.mesh=e,!e.geometry.getAttribute("_position")){const n=e.geometry.getAttribute("position").clone();e.geometry.setAttribute("_position",n)}this.morphTargetInfluences=Array.from(e.morphTargetInfluences)}_applyMorphTargetInfluences(e){const n=this.mesh.geometry.getAttribute("position"),s=this.mesh.geometry.getAttribute("_position");for(let r=0;r<n.count;++r){m.fromBufferAttribute(s,r);for(let o=0;o<e.length;++o){const a=this.mesh.geometry.morphAttributes.position[o];q.fromBufferAttribute(a,r),m.addScaledVector(q,e[o])}n.setXYZ(r,m.x,m.y,m.z)}n.needsUpdate=!0}update(){this._applyMorphTargetInfluences(this.morphTargetInfluences)}}new f;function ue(){const{scene:t,nodes:e}=C("/faceless-avatar.glb",null,!0),{bones:n,meshes:s,morphers:r}=c.exports.useMemo(()=>{const o={head:e.Head,eyeL:e.LeftEye,eyeR:e.RightEye},a=[];t.traverse(l=>{l.isMesh&&l.morphTargetInfluences.length>0&&a.push(l)});const u=a.map(l=>new ce(l));return{bones:o,meshes:a,morphers:u}},[e]);return Object.assign(window,{meshes:s}),c.exports.useEffect(()=>{t.traverse(o=>{o.isMesh&&(o.material.metalness=1,o.material.roughness=.1,o.material.color.set("white"))})},[t]),T((o,a)=>{n.head.setRotationFromQuaternion(a);for(let u of r){for(let l in o){const p=u.mesh.morphTargetDictionary[l];u.morphTargetInfluences[p]=o[l]}u.update()}}),i("primitive",{object:t})}C.preload("/faceless-avatar.glb");function le(t,e){return c.exports.useMemo(()=>J(t,e),[t])}new b;new f;new f;new f;function he({socket:t}){return T((e,n)=>{t.volatile.emit("face",{blendShapes:e,headOrientation:n.toArray()})}),null}function de(){const[t]=c.exports.useState(()=>new re),e=a=>{t.renderer=a.gl,t.sessionInit.requiredFeatures=["worldSensing"],t.start()},{token:n}=v(),s=le("https://expressive-avatars-server.herokuapp.com/provider",{query:{token:n}}),[r,o]=c.exports.useState();return c.exports.useEffect(()=>{const a=u=>o(u);return s.on("hub_name",a),()=>s.removeListener("hub_name",a)},[s]),h(A,{children:[i(se,{onCreated:e,children:i(te,{children:h(c.exports.Suspense,{fallback:null,children:[i(G,{preset:"apartment",background:!0}),i(he,{socket:s}),i(ae,{children:i("group",{"position-z":-5,scale:10,children:i("group",{position:[0,-.6,0],children:i(ue,{})})})})]})})}),K.exports.createPortal(i(me,{children:i("div",{className:"fixed bottom-0 flex justify-center w-full",children:h("div",{className:"bg-white rounded-t-lg shadow-lg w-[450px] mx-8 p-8 flex flex-col items-center gap-4",children:[h("div",{className:"flex flex-col items-center",children:[h("span",{className:"flex items-center gap-2",children:[i(fe,{color:r?"green":"orange",size:10}),r?"Connected":"Waiting for connection..."]}),i("p",{className:"text-hubs-gray",children:r!=null?r:"Join a compatible room on Hubs desktop"})]}),h("span",{className:"flex gap-4",children:[i(S,{children:"Recenter"}),i(S,{children:"Pause"})]})]})})}),t.domOverlay.root)]})}function fe({color:t="green",size:e=10}){return i("div",{style:{display:"inline-block",width:e,height:e,backgroundColor:t,borderRadius:9999}})}function me({children:t}){return i("div",{className:"absolute inset-0",children:t})}function pe(){const[t,e]=c.exports.useState(!1);return t?i(de,{}):i(ge,{onStart:()=>{console.log("starting XR session"),e(!0)}})}function ge({onStart:t}){const e=v();return h("div",{className:"flex flex-col justify-center items-center w-full h-full",children:[i("img",{alt:"Augmented Environments Lab logo",src:"/ael-logo.jpg",width:200}),e?i(we,{onStart:t}):i(ye,{})]})}function ye(){const t=j();return i("a",{href:t,children:i(S,{children:"Sign In"})})}function we({onStart:t}){const{email:e}=v(),n=j();return h(A,{children:[h("div",{className:"mb-6 text-center",children:[h("p",{children:["Signed in as ",i("span",{className:"font-semibold",children:Le(e)})]}),i("a",{className:"text-hubs-blue hover:text-hubs-lightblue",href:n,children:"Switch account"})]}),i(S,{primary:!0,onClick:t,children:"Start Tracking"})]})}function Le(t){const[e,n]=t.split("@");return`${e.substring(0,3)}...@${n}`}function j(){const t=new URL("https://hubs.aelatgt.net/signin");return t.searchParams.set("sign_in_destination_url","https://ios.aelatgt.net"),t.toString()}Y.render(i(E.StrictMode,{children:i(pe,{})}),document.getElementById("root"));
